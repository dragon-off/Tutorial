#loadcache2("WLTERM*" true)

<tree version="1.0"
      image ="images/wterminal.gif">
    #cdata("label" $text.getText("wterminal.treeHeading"))

    #set( $top_node_label          = $text.getText("wterminal.generalNodeLabel"))
    #set( $group_node_label        = $text.getText("wterminal.groupNodeLabel")  )

    #set( $top_node_image          = "images/wterminals.gif"                    )
    #set( $group_node_image        = "images/wterminal_group.gif"               )
    #set( $item_node_image         = "images/wterminal.gif"                     )

    #set( $section_main            = "WLTERM"                                   )

    #set( $top_node_grid           = "./wterminals/form_wterminals.vm"          )
    #set( $group_node_grid         = "./wterminals/form_wterminal_group.vm"     )
    #set( $item_node_grid          = "./wterminals/form_wterminal.vm"           )

    #set( $top_node_action         = "./wterminals/action_wterminals.vm"        )
    #set( $group_node_action       = "./wterminals/action_wterminal_group.vm"   )
    #set( $item_node_action        = "./wterminals/action_wterminal.vm"         )

##------------------------------------------------------------------------------

    ## Get a list with the names of all items

    #set($items = $sm.getStringList( $section_main, "NAME"))

    ## Get the number of items in the system

    #set($maxitems   = $sm.getNumericSetting( $section_main, "MAX"))

    #nodestart($top_node_label $top_node_image)
            <grid-ref>
                #cdata("name" $top_node_grid)
            </grid-ref>
            <action-ref>
                #cdata("name" $top_node_action)
                #param("section" ${section_main})
            </action-ref>


            #set($groups = $sm.getMaxSettings($qf.getScriptManager(), $section_main, "SETTINGS"))

            #if( $maxitems > 0 )
                #foreach($group in [1..$groups])
                    #nodestart("$group_node_label $group" $group_node_image)
                            <grid-ref>
                                #cdata("name" $group_node_grid)
                                #param("item" ${group})
                            </grid-ref>
                            <action-ref>
                                #cdata("name" $group_node_action)
                                #param("item" ${group})
                                #param("section" ${section_main})
                            </action-ref>

                            ## List all items that contains in this groups
                            #foreach($item in [1..$maxitems])
                                #if($sm.isMemberOfGroup($section_main, "SETTINGS", $group, $item))
                                    #set($name=$sm.getStringSetting($section_main, "NAME$item"))

                                    #nodestart("$item. $name" $item_node_image)
                                          <grid-ref>
                                                #cdata("name" $item_node_grid)
                                                #param("item" ${item})
                                                #param("name" $sm.getStringSetting($section_main, "NAME$item"))
                                          </grid-ref>
                                          <action-ref>
                                                #cdata("name" $item_node_action)
                                                #param("item" ${item})
                                                #param("group" ${group})
                                                #param("section" ${section_main})
                                          </action-ref>
                                        

                                    </node>
                                #end
                                #set($item = $item + 1)
                            #end
                    </node>
                #end
            #end
    </node>


</tree>
